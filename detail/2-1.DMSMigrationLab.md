# DMS Migration Lab

### 순서

- 안내
1. Subnet Group 생성
2. DMS Replication Instance 생성
3. DMS Source Endpoint 생성
4. DMS Target Endpoint 생성
5. Initial full copy 수행을 위한 Task 생성
6. (Optional) 소스 데이터 변경분을 지속적으로 복제하는 기능을 위한 CDC endpoint 생성
7. (Optional) 소스 데이터 변경분을 지속적으로 복제하는 기능을 위한 Task 생성
- 다음 단계

### - 안내

이 실습은 AWS Database Migration Service (AWS DMS) 에 대한 이해를 돕기위한 것으로서, 이미 만들어진 Amazon Relational Database Service (Amazon RDS) Postgres 데이터베이스로부터 Amazon Simple Storage Service (Amazon S3) 버킷으로 데이터를 마이그레이션하게 됩니다.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/30.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/30.png)

이번 실습동안 아래와 같은 작업을 수행하게 됩니다:

1. DMS Lab VPC 에 subnet group 생성
2. DMS replication instance 생성
3. DMS source endpoint 생성
4. DMS target endpoint 생성
5. Initial full copy 수행을 위한 Task 생성

부가적으로, 소스 데이터 변경분을 지속적으로 복제하는 기능에 대한 실습도 가능합니다: (Only one of the DMS replication instances will enable this 
feature.)

1. CDC 파일을 위한 별도의 Target endpoint 생성
2. 소스 데이터 변경분을 지속적으로 복제하는 기능을 위한 Task 생성

우리의 실습 환경에는 이미 RDS Postgres 데이터베이스가 생성되어 있어, 이를 소스 엔드포인트로 사용하게 됩니다.


### 1. Subnet Group 생성

1. [DMS 콘솔](https://console.aws.amazon.com/dms/v2/home#createSubnetGroup) 로 이동하여, Subnet Groups 를 선택한 후, Create subnet group 을 클릭하세요.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/31.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/31.png)

- Name 에는, 쉽게 알아볼 수 있는 이름을 입력합니다. (e.g., `dms-lab-subnet-grp`).
- Description 에는, 쉽게 알아볼 수 있는 설명을 입력합니다. (e.g., `Replication instance for production data system`).
- VPC 는, 생성한 VPC의 이름을 선택합니다. VPC 이름은 **dmslstudv1** 로 끝납니다.
- 원하는 만큼 서브넷을 선택하고 추가를 클릭합니다. 선택한 서브넷이 아래에 푸른색으로 표시됩니다.

  > DMS는 최소한 두 개 이상의 가용영역(AZ)을 선택해야 합니다.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/32.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/32.png)

2. Create subnet group 을 클릭합니다.
3. DMS 콘솔 상에서, subnet group 의 Status 가 **Complete** 로 표시된 것을 확인합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/33.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/33.png)
    

### 2. DMS Replication Instance 생성

1. DMS 콘솔에서, 새 복제 인스턴스를 생성하기 위해 [Replication instances](https://console.aws.amazon.com/dms/v2/home#createReplicationInstance) 선택 후 Create replication instance 를 클릭합니다.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/34.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/34.png)

- Name 에는, 쉽게 인식할 수 있는 복제 인스턴스의 이름을 입력합니다. (e.g., `DMS-Replication-Instance`).
- Description 에는, 쉽게 알아볼 수 있는 설명을 입력합니다. (e.g., `DMS Replication Instance`).
- Instance class 에는, **dms.t3.medium** 를 선택합니다.
- Engine version 은, 최신버전을 선택합니다.
- VPC 는, 미리 프로비저닝된 VPC의 이름을 선택합니다. 해당 VPC 이름은 **dmslstudv1** 로 끝납니다.
- Multi AZ 는, 드롭다운 메뉴에서 **Dev or test workload (Single-AZ)** 를 선택합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/35.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/35.png)
    
- **Advanced security and network configuration** 섹션을 클릭하여 확장합니다.
- VPC security group(s) 에는, **sgdefault** 또는 **default** 명칭을 가진 security group 을 선택합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/36.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/36.png)
    
- 다른 필드는 기본값으로 두고, **Create** 를 클릭합니다.
- DMS 콘솔에 생성한 인스턴스에 대한 상태가 표시됩니다. 복제 인스턴스가 준비되면 상태가 Available 로 변경됩니다. 복제 인스턴스가 가동되는 동안, 다음 단계로 넘어가도 무방합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/37.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/37.png)
    

### 3. DMS Source Endpoint 생성

앞 단계를 기다리지 말고 엔드포인트 생성을 진행하십시오.

1. 소스 엔드포인트를 생성하기 위해, DMS 콘솔에서 [Endpoint](https://console.aws.amazon.com/dms/v2/home#createNewEndpoint) 를 선택하고, Create endpoint 를 클릭합니다.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/38.1.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/38.1.png)

- Endpoint type 에서, **Source Endpoint** 를 선택합니다.
- Endpoint identifier 에는, 쉽게 인식할 수 있는 이름을 입력합니다. (e.g. `rds-source-endpoint`)
- Source engine 에는, `PostgreSQL` 를 선택합니다.
- "Access to Endpoint database" 에는, "Provide access information manually" 를 선택합니다.
- Server name 에는, 이벤트 엔진 대시보드의 Environment Setup 모듈에서 **Database Endpoint** 를 찾아 복붙합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/db_endpoint.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/db_endpoint.png)
    
- Port 는, `5432` 를 입력합니다.
- User name 은, `adminuser` 를 입력합니다.
- Password 는, `admin123` 를 입력합니다.
- SSL mode 는, `none` 을 선택합니다.
- Database name dms, `sportstickets` 을 입력합니다.

*(이러한 자격 증명은 CFN 템플릿에 직접 정의되어 있습니다.)*

2. 나머지 항목은 기본값으로 두고, Create endpoint 를 클릭하여 소스 엔드포인트를 생성합니다. 사용 가능해지면, 엔드포인트 상태가 active 로 변경됩니다.
3. 앞 단계에서 생성한 복제 인스턴스를 확인합니다. 상태가 Available 로 전환되었는지 확인하십시오.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/40.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/40.png)
    

4. 새로 만든 소스 엔드포인트를 선택하고, Actions 드롭다운 목록에서 Test connection 를 선택합니다.

    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/41.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/41.png)

5. Run test 를 클릭하여, 소스 데이터베이스 시스템에 대한 연결을 테스트합니다. 성공하면 Status 가 “successful” 로 전환됩니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/42.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/42.png)
    
  > 테스트가 실패할 경우 1) RDS 데이터베이스 인스턴스 보안 그룹에 대한 인바운드 액세스를 허용하는 단계를 따랐는지, 2/ 입력한 데이터베이스 자격 증명이 올바른지 확인하십시오.


### 4. DMS Target Endpoint 생성

시작하기 전에 이벤트 엔진 대시보드의 Environment Setup 모듈에 아래 항목 값이 있는지 확인하십시오.

- ARN of DMSLabRole to access S3 : "arn:aws:iam::<account number>:role/xxx-DMSLabRoleS3-xxxx" 와 유사한 형태입니다.
- S3 Bucket name : “xxx-dmslabs3bucket-xxxx” 와 유사한 형태입니다.
  > 같은 값을 CloudFormation 에서도 아래와 같은 형태로 확인할 수 있습니다.   ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/43.1.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/43.1.png)
    
1. 타겟 엔드포인트를 생성하기 위해, DMS 콘솔에서 Endpoints 를 선택하고 [Create endpoint](https://console.aws.amazon.com/dms/v2/home#createNewEndpoint) 를 선택합니다.

    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/43.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/43.png)

- Endpoint type 에서, **Target Endpoint** 를 선택합니다.
- Endpoint identifier 에는, 쉽게 인식할 수 있는 이름을 입력합니다. (e.g. `s3-target-endpoint`)
- Target engine 에는, **Amazon S3** 를 선택합니다.
- Service access role ARN 에는, 앞서 언급된 ARN of DMSLabRole to access S3 값을 붙여넣습니다.
- Bucket name 에는, 앞서 언급된 S3 Bucket Name 값을 붙여넣습니다.
- Bucket folder 에는, `tickets` 을 입력합니다.
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/44.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/44.png)
    
- Endpoint settings 섹션을 확장합니다.
- **Use endpoint connection attributes** 체크박스를 클릭하여 활성화시키고, Extra connection attributes 항목에 `addColumnName=true` 를 입력합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/dms_settings.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/dms_settings.png)
    
- Test endpoint connection (optional) 섹션을 확장시키고, VPC 드롭다운 목록에서 **dmslstudv1** 로 끝나는 VPC 를 선택합니다.
- Run test 를 클릭하여, 타겟 데이터베이스 시스템에 대한 연결을 테스트합니다. 성공하면 Status 가 “successful” 로 전환됩니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/45.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/45.png)
    

2. Create Endpoint 를 클릭합니다. When available, the endpoint status changes to active.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/46.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/46.png)


### 5. Initial full copy 수행을 위한 Task 생성

1. DMS 콘솔에서, **Database migration tasks** 를 선택합니다.
2. Create Task 를 클릭합니다.
    - Task Identifier 에는, 쉽게 알아볼 수 있는 태스크 이름을 입력합니다. e.g. `dms-full-dump-task`
    - Replication instance 에, 매칭되는 자원을 선택합니다.
    - Source database endpoint 에, 매칭되는 자원을 선택합니다.
    - Target database endpoint 에, 매칭되는 자원을 선택합니다.
    - Migration type 에, **Migrate existing data** 를 선택합니다.
        
        ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/47.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/47.png)
        
- Task Settings 섹션에서, **Enable CloudWatch logs** 체크박스를 선택합니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/48.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/48.png)
    
- **Table Mappings** 섹션에서, Add new selection rule 을 클릭하고, Schema 항목의 드롭다운 클릭 후 “Enter a Schema” 를 선택합니다.
- Source name 에 `dms_sample` 를 입력합니다. 나머지 필드는 그대로 둡니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/49.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/49.png)
    

3. **Create task** 를 클릭합니다. 해당 Task가 생성되고 자동으로 시작됩니다.
    > 전체 생성 및 데이터 추출 프로세스는 5~15분이 소요됩니다.
4. 완료되면, 콘솔에 진행률이 **100%** 로 표시됩니다.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/50.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/50.png)
    

5. 해당 Task 를 선택하고 내용을 살펴보세요. Table statistics 탭을 클릭하면, RDS 에서 S3 로 로드된 모든 테이블 정보를 확인할 수 있습니다.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/51.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/51.png)

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/52.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/52.png)

6. S3 콘솔을 열고 DMS에서 복사한 데이터를 확인합니다.

S3 bucket 에 복제된 데이터의 구조는 다음과 같습니다:
    **BucketName/bucket_folder_name/schema_name/table_name/objects/**
우리의 실습에서는 아래와 같습니다:
    */dmslab-student-dmslabs3bucket-woti4bf73cw3/tickets/dms_sample*(각 tabel_name 에 대한 별도의 경로 포함)

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53.png)

7. 파일 중 하나로 이동하여 [S3 Select](https://docs.aws.amazon.com/AmazonS3/latest/userguide/selecting-content-from-objects.html) 를 사용하여 검토해보겠습니다.:
   a. **player**라는 디렉터리로 이동한 후, 파일 이름 앞에 있는 체크박스를 선택합니다.
   b. **Actions** 드롭다운 버튼을 클릭하고, **Query with S3 Select** 를 선택합니다.

   ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53-1.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53-1.png)

   c. Query with S3 Select 페이지에서, *Input Settings* 및 *SQL Query* 섹션의 기본값을 그대로 두고, **Run SQL query** 를 클릭합니다.

   ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53-2.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53-2.png)

   d. 지정된 SQL 쿼리를 실행하여 해당 CSV 파일의 처음 5개 줄을 반환한 것을 확인할 수 있습니다.

   ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53-3.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/53-3.png)
    
    
   S3 타겟 엔드포인트를 생성할 때 포함했던 **“AddColumnName=true”** conncetion attribute 에서 요청한 대로, 파일에 열 헤더가 포함되어 있음을 알 수 있습니다. 단, 열 이름은 파일의 첫 번째 행에 포함되어 있습니다.

S3 디렉터리의 객체들을 좀 더 자세히 살펴보세요.

    
### 6. (Optional) 소스 데이터 변경분을 지속적으로 복제하는 기능을  CDC endpoint 생성
  
As of now we are enabling only one schema replication for CDC. Copy the following values from the Event Engine Team Dashboard.

- ARN of DMSLabRole to access S3 - It looks like “arn:aws:iam::<account number>:role/xxx- DMSLabRoleS3-xxxx“
- S3 Bucket name - It looks like “xxx-dmslabs3bucket-xxxx”
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/43.1.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/43.1.png)
    
- On the DMS console, select Endpoints.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/55.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/55.png)
    

Click Create endpoint.

- For Endpoint type, select **Target**.
- For Endpoint identifier, type an easily recognized name e.g. `rds-cdc-endpoint`
- For Target engine, choose **Amazon S3**.
- For Service Access Role ARN, paste the ARN value that you noted earlier
- For Bucket name, type the name of the s3 bucket you noted down earlier
- For Bucket folder, type **cdc**.

Make sure you enter folder name as **cdc**. If you don't use different folder name than during fully copy, your Glue ETL Lab will fail while running the job.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/56.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/56.png)

- Click Endpoint-specific settings to expand the section.
- In the Extra connection attributes box, type `addColumnName=true`. This attribute includes the column names in the files in the S3 bucket.
- Expand the Test endpoint connection (optional) section, and choose your **dmslstudv1** name on the VPC drop-down list.
- Click Run test. This step tests connectivity to the source database
system. If successful, the message “Connection tested successfully”
appears.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/57.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/57.png)
    
- Click Create endpoint.
- When available, the endpoint status changes to active.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/58.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/58.png)
    

### 7. (Optional) 소스 데이터 변경분을 지속적으로 복제하는 기능을 위해 Task 생성

1. On the DMS console, select Database Migration Tasks.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/59.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/59.png)
    

Click Create Task.

- Type an easily recognized Task Identifier. For example `cdctask`.
- Select your Replication instance.
- Select your Source endpoint.
- Select your Target endpoint as cdc endpoint created in the previous section.
- For Migration type, choose **Replicate data changes only**.
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/60.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/60.png)
    

In Task Settings, Select the Enable CloudWatch logs check box. Do not enable the validation.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/61.1.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/61.1.png)

- Go to Table Mappings.
- Click on Add new selection rule and select “Enter a Schema” in Schema field.
- For Schema name, select `dms_sample` . Keep the settings for the remaining fields
    
    ![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/62.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/62.png)
    

Click Create task. Your task is created and starts automatically. You
 can see status as ongoing replication, after couple of minutes.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/63.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/63.png)

Once complete, the console displays 100% complete.

1. Your instructor will generate CDC activity which the above migration task will capture. If you ran the instructor setup on your own, then
make sure to follow **[Generate the CDC Data(/400/401/410-pre-lab-1#generate-and-replicate-the-cdc-data-(optional))** section from instructor lab.

You may need to wait 5 to 10 minutes for CDC data to first reflect in
 your RDS postgres database and then picked up by DMS CDC migration 
task.

1. Once the CDC Data gets replicated, you can navigate to CDC task details, see **Table statistics** section and verify it, as shown below:

In
 case you see DMS CDC task in fail/error status. Make sure your 
replication instance version is greater than 3.3.2 and it is large 
enough (dms.t2.medium or above) to run CDC replication task

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/64.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/64.png)

Open the S3 console and view the CDC data that was copied by DMS.

Your S3 bucket name will look like below : BucketName/bucket_folder_name/schema_name/table_name/objects/

In our lab example this becomes: */dmslab-student-dmslabs3bucket-woti4bf73cw3/cdc/dms_sample* with a separate path for each table_name

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65.png)

Navigate to one of the files and review it using [S3 Select](https://docs.aws.amazon.com/AmazonS3/latest/userguide/selecting-content-from-objects.html)

:
a. Navigate in to the directory named

**sporting_event_ticket**

and select the check box next to the file name.

b. Click the

**Actions**

dropdown button and choose

**Query with S3 Select**

.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65-1.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65-1.png)

c. In the Query with S3 Select page, leave the default value for

*Input Settings*

and

*SQL Query*

and click

**Run SQL query**

.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65-2.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65-2.png)

d. It will execute the specified SQL query and return the first 5 lines from the CSV file.

![https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65-3.png](https://static.us-east-1.prod.workshops.aws/public/03be2e95-54e1-4b84-aa89-e115b803304a/static/400/images/65-3.png)

You
 will notice that the file contains the column headers in the first row 
as requested by the “addColumnName=true” connection attribute we 
included when we created the s3 target endpoint.

> Note that file name has date time - 20210915-085904798.csv
> 

You can see the header is included and the operation column is added 
at the beginning of each row. The file below shows updates (U) to the 
table along with the values after the update. Inserts (I) show data 
after the insert and Deletes (D) show data before the delete.

Explore the objects in the S3 directory further.
  
### 다음 단계

아래를 클릭하시여 다음 실습으로 이동합니다.
- [3.Lab: Transforming data with Glue](../detail/3.Lab:TransformingdatawithGlue.md)
